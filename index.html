<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تأثيرات السعة في خطوط النقل الكهربائية - تقرير تفاعلي</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Google Fonts for Arabic -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #F3F4F6;
            color: #1F2937;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 400px;
            max-height: 500px;
            margin-left: auto;
            margin-right: auto;
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }

        .nav-btn.active {
            background-color: #1E3A8A;
            color: white;
            border-bottom: 4px solid #D97706;
        }

        .nav-btn { transition: all 0.3s ease; }

        .slidecontainer { width: 100%; }

        input[type=range] { -webkit-appearance: none; width: 100%; height: 8px; border-radius: 5px; background: #d1d5db; outline: none; opacity: 0.7; transition: opacity .2s; }
        input[type=range]:hover { opacity: 1; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #1E3A8A; cursor: pointer; }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-900 rounded-lg flex items-center justify-center text-white font-bold text-xl">⚡</div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold text-gray-900">هندسة القوى الكهربية</h1>
                    <p class="text-sm text-gray-500">تقرير تفاعلي: السعة في خطوط النقل (Capacitance)</p>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <nav class="bg-gray-100 border-t border-gray-200 overflow-x-auto">
            <div class="container mx-auto flex whitespace-nowrap min-w-max">
                <button onclick="switchTab('overview')" id="btn-overview" class="nav-btn active px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">نظرة عامة والمفاهيم</button>
                <button onclick="switchTab('factors')" id="btn-factors" class="nav-btn px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">العوامل الهندسية</button>
                <button onclick="switchTab('ferranti')" id="btn-ferranti" class="nav-btn px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">ظاهرة فيرانتي</button>
                <button onclick="switchTab('models')" id="btn-models" class="nav-btn px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">نمذجة الخطوط</button>
                <button onclick="switchTab('calculator')" id="btn-calculator" class="nav-btn px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">حاسبة تيار الشحن</button>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 flex-grow">

        <!-- SECTION 1: OVERVIEW -->
        <section id="sec-overview" class="space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">مقدمة في سعة خطوط النقل</h2>
                <p class="text-gray-700 leading-relaxed text-lg mb-6">...</p>
            </div>
        </section>

        <!-- SECTION 2: FACTORS -->
        <section id="sec-factors" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">العوامل الهندسية المؤثرة</h2>
                <div class="flex flex-col lg:flex-row gap-8">
                    <div class="w-full lg:w-1/3 space-y-6 bg-gray-50 p-6 rounded-lg h-fit">
                        <label class="block font-bold text-gray-700 mb-2">المسافة بين الموصلات (D)</label>
                        <input type="range" min="1" max="10" step="0.5" value="4" class="slidecontainer" id="slider-D">
                        <div class="flex justify-between text-sm text-gray-500 mt-1">
                            <span>1m</span>
                            <span id="val-D" class="font-bold text-blue-800">4m</span>
                            <span>10m</span>
                        </div>
                    </div>
                    <div class="w-full lg:w-2/3">
                        <div class="chart-container"><canvas id="factorsChart"></canvas></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: FERRANTI EFFECT -->
        <section id="sec-ferranti" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">ظاهرة فيرانتي (Ferranti Effect)</h2>
                <div class="flex flex-wrap gap-4 mb-6">
                    <button onclick="updateFerranti(true)" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow transition">تشغيل بحمل كامل (Full Load)</button>
                    <button onclick="updateFerranti(false)" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded shadow transition">تشغيل بدون حمل (No Load)</button>
                </div>
                <div class="chart-container" style="max-height: 450px;"><div id="ferrantiPlot" style="width:100%; height:100%;"></div></div>
                <div class="mt-4 text-center"><p id="ferranti-desc" class="font-bold text-red-600 text-lg">الحالة: بدون حمل - لاحظ ارتفاع الجهد في نهاية الخط!</p></div>
            </div>
        </section>

        <!-- SECTION 4: MODELING -->
        <section id="sec-models" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">نمذجة الخطوط وتمثيل السعة</h2>
            </div>
        </section>

        <!-- SECTION 5: CALCULATOR -->
        <section id="sec-calculator" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">حاسبة تيار الشحن (Charging Current)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-4 bg-gray-50 p-6 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700">جهد الخط (Line Voltage - kV)</label>
                        <input type="number" id="calc-v" value="220" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm">
                        <label class="block text-sm font-medium text-gray-700">التردد (Frequency - Hz)</label>
                        <input type="number" id="calc-f" value="50" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm">
                        <label class="block text-sm font-medium text-gray-700">طول الخط (km)</label>
                        <input type="number" id="calc-l" value="150" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm">
                        <label class="block text-sm font-medium text-gray-700">السعة (μF/km)</label>
                        <input type="number" id="calc-c" value="0.012" step="0.001" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm">
                        <button onclick="calculate()" class="w-full bg-blue-900 text-white py-2 rounded-md hover:bg-blue-800 transition">احسب النتائج</button>
                    </div>
                    <div class="space-y-6 flex flex-col justify-center">
                        <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600"><h4 class="text-sm text-gray-500 uppercase font-bold">تيار الشحن الكلي (Ic)</h4><div class="flex items-end gap-2"><span id="res-ic" class="text-4xl font-bold text-blue-900">--</span><span class="text-xl text-gray-600 mb-1">Amps</span></div></div>
                        <div class="bg-amber-50 p-6 rounded-lg border-l-4 border-amber-600"><h4 class="text-sm text-gray-500 uppercase font-bold">القدرة غير الفعالة المولدة (Qc)</h4><div class="flex items-end gap-2"><span id="res-mvar" class="text-4xl font-bold text-amber-900">--</span><span class="text-xl text-gray-600 mb-1">MVAR</span></div></div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white py-8 mt-auto"><div class="container mx-auto px-4 text-center"><h3 class="font-bold text-lg mb-2">تقرير هندسي: سعة خطوط النقل</h3><p class="text-gray-400 text-sm max-w-2xl mx-auto">تم إعداد هذا التقرير التفاعلي لتوضيح المفاهيم الأساسية، العوامل المؤثرة، وتأثيرات التشغيل المتعلقة بالسعة في شبكات القوى الكهربية.</p><div class="mt-4 text-xs text-gray-500">&copy; 2023 Engineering Reports SPA</div></div></footer>

    <script>
        const state = { currentSection: 'overview', factors: { d: 4, r: 1.5 }, ferrantiLoaded: false };

        function switchTab(tabId) {
            state.currentSection = tabId;
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById(`btn-${tabId}`);
            if (activeBtn) activeBtn.classList.add('active');
            ['overview','factors','ferranti','models','calculator'].forEach(sec => { const el = document.getElementById(`sec-${sec}`); if (!el) return; if (sec===tabId) el.classList.remove('hidden'); else el.classList.add('hidden'); });
            if (tabId === 'factors') updateFactorsChart(); if (tabId === 'ferranti') updateFerrantiPlot();
        }

        let factorsChart = null;
        function initFactorsChart(){ const canvas = document.getElementById('factorsChart'); if(!canvas) return; const ctx = canvas.getContext('2d'); const dataPoints = generateFactorsData(state.factors.r); factorsChart = new Chart(ctx,{type:'line',data:{labels:dataPoints.labels,datasets:[{label:`Capacitance (μF/km) @ r=${state.factors.r}cm`,data:dataPoints.data,borderColor:'#1E3A8A',backgroundColor:'rgba(30,58,138,0.1)',borderWidth:3,tension:0.4,pointRadius:0,fill:true}]},options:{responsive:true,maintainAspectRatio:false,scales:{x:{title:{display:true,text:'المسافة بين الموصلات (m)'},grid:{color:'#e5e7eb'}},y:{title:{display:true,text:'السعة C (μF/km)'},grid:{color:'#e5e7eb'}}},plugins:{tooltip:{intersect:false,mode:'index',callbacks:{label:function(context){const y=context.parsed&&context.parsed.y;return y==null?'C: -':`C: ${y.toFixed(4)} μF/km`;}}}}}); }
        function generateFactorsData(radiusCm){ const labels=[]; const data=[]; const r_m = radiusCm/100; for(let d=1; d<=10; d+=0.5){ labels.push(d); if(d>r_m && r_m>0){ const ratio=d/r_m; const c=0.0241/Math.log10(ratio); data.push(isFinite(c)?c:null); } else { data.push(null); } } return {labels,data}; }
        function updateFactorsChart(){ if(!factorsChart){ initFactorsChart(); return;} const newData = generateFactorsData(state.factors.r); factorsChart.data.datasets[0].label = `Capacitance (μF/km) @ r=${state.factors.r}cm`; factorsChart.data.datasets[0].data = newData.data; factorsChart.update(); }
        function setupFactorsControls(){ const sliderD=document.getElementById('slider-D'); const sliderR=document.getElementById('slider-r'); const valD=document.getElementById('val-D'); const valR=document.getElementById('val-r'); if(valD) valD.textContent = state.factors.d + 'm'; if(valR) valR.textContent = state.factors.r + 'cm'; if(sliderD && valD){ sliderD.addEventListener('input',(e)=>{ state.factors.d=parseFloat(e.target.value); valD.textContent = state.factors.d + 'm'; }); } if(sliderR && valR){ sliderR.addEventListener('input',(e)=>{ state.factors.r=parseFloat(e.target.value); valR.textContent = state.factors.r + 'cm'; updateFactorsChart(); }); } }

        function updateFerranti(isLoaded){ state.ferrantiLoaded = isLoaded; const desc=document.getElementById('ferranti-desc'); if(desc){ if(isLoaded){ desc.textContent='الحالة: حمل كامل - انخفاض الجهد طبيعي بسبب الممانعة.'; desc.className='font-bold text-green-600 text-lg'; } else { desc.textContent='الحالة: بدون حمل - لاحظ ارتفاع الجهد (Ferranti Effect)!'; desc.className='font-bold text-red-600 text-lg'; } } updateFerrantiPlot(); }
        function updateFerrantiPlot(){ const plotEl=document.getElementById('ferrantiPlot'); if(!plotEl) return; const distance=Array.from({length:301},(_,i)=>i); const voltage=distance.map(x=>{ if(!state.ferrantiLoaded) return 1.0+(0.0000005*x*x); return 1.0-(0.00015*x); }); const trace={x:distance,y:voltage,mode:'lines',line:{color:state.ferrantiLoaded?'#16a34a':'#dc2626',width:3},fill:'tozeroy',fillcolor:state.ferrantiLoaded?'rgba(22,163,74,0.1)':'rgba(220,38,38,0.1)'}; const layout={title:{text:state.ferrantiLoaded?'توزيع الجهد (Full Load)':'توزيع الجهد (No Load - Ferranti)',font:{family:'Tajawal'}},xaxis:{title:'طول الخط (كم)'},yaxis:{title:'الجهد (p.u.)',range:[0.9,1.1]},margin:{t:40,r:20,l:50,b:40},font:{family:'Tajawal'}}; Plotly.newPlot('ferrantiPlot',[trace],layout,{responsive:true,displayModeBar:false}); }

        function calculate(){ const vEl=document.getElementById('calc-v'); const fEl=document.getElementById('calc-f'); const lEl=document.getElementById('calc-l'); const cEl=document.getElementById('calc-c'); if(!vEl||!fEl||!lEl||!cEl) return; const V_kV=parseFloat(vEl.value); const f=parseFloat(fEl.value); const L=parseFloat(lEl.value); const C_uF=parseFloat(cEl.value); if(isNaN(V_kV)||isNaN(f)||isNaN(L)||isNaN(C_uF)) return; const V_phase=(V_kV*1000)/Math.sqrt(3); const C_total=C_uF*1e-6*L; const omega=2*Math.PI*f; const Ic=omega*C_total*V_phase; const Qc_VAR=Math.sqrt(3)*(V_kV*1000)*Ic; const Qc_MVAR=Qc_VAR/1e6; animateValue('res-ic',0,Ic,1000,1); animateValue('res-mvar',0,Qc_MVAR,1000,2); }
        function animateValue(id,start,end,duration,decimals){ const obj=document.getElementById(id); if(!obj) return; let startTimestamp=null; const step=(timestamp)=>{ if(!startTimestamp) startTimestamp=timestamp; const progress=Math.min((timestamp-startTimestamp)/duration,1); obj.innerHTML=(progress*(end-start)+start).toFixed(decimals); if(progress<1) window.requestAnimationFrame(step); }; window.requestAnimationFrame(step); }

        window.addEventListener('DOMContentLoaded',()=>{ setupFactorsControls(); initFactorsChart(); switchTab(state.currentSection); updateFerrantiPlot(); calculate(); });
    </script>
</body>
</html>