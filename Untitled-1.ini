<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุฃุซูุฑุงุช ุงูุณุนุฉ ูู ุฎุทูุท ุงูููู ุงูููุฑุจุงุฆูุฉ - ุชูุฑูุฑ ุชูุงุนูู</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Google Fonts for Arabic -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- Chosen Palette: Warm Engineering Neutral
         Background: #F9FAFB (Cool Gray 50) - Clean, technical canvas
         Primary: #1E3A8A (Blue 900) - Professional Engineering Blue
         Secondary: #D97706 (Amber 600) - Electricity/Warning highlight
         Text: #1F2937 (Gray 800) - High readability
    -->

    <!-- Application Structure Plan:
         1. Header: Title and context.
         2. Navigation (Tab-based): Logical flow from Basics -> Physics -> Phenomena -> Calculation.
            - "Overview": Introduction and definitions (Text & Icons).
            - "Geometric Factors": Interactive simulation showing how Spacing (D) and Radius (r) affect C (Chart.js).
            - "Ferranti Effect": Visualization of voltage rise along the line (Plotly.js).
            - "Calculator": Functional tool for engineers to estimate Charging Current (Ic).
         3. Footer: Summary/Conclusion.
         
         Rationale: This structure breaks complex engineering theory into digestible, interactive chunks. 
         Instead of reading 7 pages of equations, the user *plays* with the variables to see the relationships directly.
    -->

    <!-- Visualization & Content Choices:
         1. Factors Chart (Chart.js): Goal: Demonstrate C โ 1/ln(D/r). Interaction: Sliders for D and r. Justification: Static formulas are hard to visualize; moving curves make the inverse log relationship intuitive.
         2. Ferranti Plot (Plotly.js): Goal: Show voltage profile vs distance. Interaction: Toggle Load/No-Load. Justification: Plotly handles continuous function plotting well for the hyperbolic line equations.
         3. Calculator (JS/DOM): Goal: Practical application. Interaction: Input fields for V, f, Length. Justification: Instant feedback loop for "What-if" scenarios.
         4. Circuit Models (CSS/HTML): Goal: Visualizing Pi vs T models. Method: CSS Borders/Grid. Justification: Clean, lightweight schematic representation without images/SVG.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #F3F4F6;
            color: #1F2937;
        }

        /* Chart Container Styling - STRICTLY ADHERED TO REQUIREMENTS */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px; /* Constraints width on large screens */
            height: 400px;    /* Base height */
            max-height: 500px;
            margin-left: auto;
            margin-right: auto;
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        /* Mobile adjustment for chart height */
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }

        .nav-btn.active {
            background-color: #1E3A8A; /* Blue 900 */
            color: white;
            border-bottom: 4px solid #D97706; /* Amber 600 */
        }

        .nav-btn {
            transition: all 0.3s ease;
        }

        .slidecontainer {
            width: 100%;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #d1d5db;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        input[type=range]:hover {
            opacity: 1;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1E3A8A;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-900 rounded-lg flex items-center justify-center text-white font-bold text-xl">โก</div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold text-gray-900">ููุฏุณุฉ ุงูููู ุงูููุฑุจูุฉ</h1>
                    <p class="text-sm text-gray-500">ุชูุฑูุฑ ุชูุงุนูู: ุงูุณุนุฉ ูู ุฎุทูุท ุงูููู (Capacitance)</p>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <nav class="bg-gray-100 border-t border-gray-200 overflow-x-auto">
            <div class="container mx-auto flex whitespace-nowrap min-w-max">
                <button onclick="switchTab('overview')" id="btn-overview" class="nav-btn active px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">ูุธุฑุฉ ุนุงูุฉ ูุงูููุงููู</button>
                <button onclick="switchTab('factors')" id="btn-factors" class="nav-btn px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">ุงูุนูุงูู ุงูููุฏุณูุฉ</button>
                <button onclick="switchTab('ferranti')" id="btn-ferranti" class="nav-btn px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">ุธุงูุฑุฉ ููุฑุงูุชู</button>
                <button onclick="switchTab('models')" id="btn-models" class="nav-btn px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">ููุฐุฌุฉ ุงูุฎุทูุท</button>
                <button onclick="switchTab('calculator')" id="btn-calculator" class="nav-btn px-6 py-3 font-medium text-gray-700 hover:bg-gray-200">ุญุงุณุจุฉ ุชูุงุฑ ุงูุดุญู</button>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 flex-grow">

        <!-- SECTION 1: OVERVIEW -->
        <section id="sec-overview" class="space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">ููุฏูุฉ ูู ุณุนุฉ ุฎุทูุท ุงูููู</h2>
                <p class="text-gray-700 leading-relaxed text-lg mb-6">
                    ุชุนุชุจุฑ ุงูุณุนุฉ (Capacitance) ูุงุญุฏุฉ ูู ุฃูู ุงููุนุงููุงุช ุงูุฃุฑุจุนุฉ ุงูุฃุณุงุณูุฉ ูุฎุทูุท ุงูููู (ุงูููุงููุฉ Rุ ุงููุญุซ Lุ ุงูุณุนุฉ Cุ ูุงูููุตููุฉ G). 
                    ูู ูุฐุง ุงููุณูุ ูุณุชุนุฑุถ ุงูููููู ุงูููุฒูุงุฆู ููุณุนุฉ ูููููุฉ ุชููููุง ุจูู ุงูููุตูุงุช ูุงูุฃุฑุถุ ูุฃูููุชูุง ูู ุงุณุชูุฑุงุฑ ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Concept Card 1 -->
                    <div class="bg-blue-50 p-5 rounded-lg border border-blue-100">
                        <div class="text-3xl mb-3 text-blue-600">๐</div>
                        <h3 class="font-bold text-lg mb-2">ุงูููุซู ุงูุทุจูุนู</h3>
                        <p class="text-sm text-gray-600">
                            ุฎุท ุงูููู ูุนูู ูููุซู ุทููู ุฌุฏูุง. ุงูููุตูุงุช ุชูุซู ุงูุฃููุงุญ ุงููุดุญููุฉุ ูุงูููุงุก ุจูููุง ููุซู ุงููุงุฏุฉ ุงูุนุงุฒูุฉ (Dielectric).
                        </p>
                    </div>
                    <!-- Concept Card 2 -->
                    <div class="bg-amber-50 p-5 rounded-lg border border-amber-100">
                        <div class="text-3xl mb-3 text-amber-600">โก</div>
                        <h3 class="font-bold text-lg mb-2">ุงููุฌุงู ุงูููุฑุจุงุฆู</h3>
                        <p class="text-sm text-gray-600">
                            ูุฎูู ูุฑู ุงูุฌูุฏ ุจูู ุงูููุตูุงุช ูุฌุงููุง ููุฑุจุงุฆููุง ูุดุญูููุง. ูุฐุง ุงููุฌุงู ูุณุจุจ ุชุฏูู ุชูุงุฑ ุงูุดุญู (Charging Current) ุญุชู ูู ุญุงูุฉ ุงููุงุญูู.
                        </p>
                    </div>
                    <!-- Concept Card 3 -->
                    <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                        <div class="text-3xl mb-3 text-gray-600">๐</div>
                        <h3 class="font-bold text-lg mb-2">ุงูุชุฃุซูุฑ ุนูู ุงูููุงุกุฉ</h3>
                        <p class="text-sm text-gray-600">
                            ุงูุณุนุฉ ุชุณุชููู ูุฏุฑุฉ ุบูุฑ ูุนุงูุฉ (Reactive Power) ูุชูุฏูุฉุ ููุง ูุณุงุนุฏ ูู ุชุญุณูู ูุนุงูู ุงููุฏุฑุฉ ููููู ูุฏ ูุณุจุจ ุงุฑุชูุงุน ุงูุฌูุฏ.
                        </p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="font-bold text-xl mb-4">ุงููุนุงุฏูุฉ ุงูุฃุณุงุณูุฉ</h3>
                    <div class="bg-gray-900 text-white p-6 rounded-lg font-mono text-center text-lg shadow-inner direction-ltr">
                        C = q / V
                    </div>
                    <p class="mt-4 text-gray-600 text-sm">
                        ุญูุซ <strong>C</strong> ูู ุงูุณุนุฉ ุจุงููุงุฑุงุฏุ <strong>q</strong> ูู ุงูุดุญูุฉ ุจุงููููููุ ู <strong>V</strong> ูู ูุฑู ุงูุฌูุฏ ุจุงููููุช.
                        ูู ุงูุฎุทูุท ุงูููุงุฆูุฉุ ุชุนุชูุฏ ุงูุณุนุฉ ุจุดูู ุฑุฆูุณู ุนูู ุฃุจุนุงุฏ ุงูุฎุท (Geometry) ูุณูุงุญูุฉ ุงูููุงุก.
                    </p>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm flex flex-col justify-center items-center text-center">
                    <h3 class="font-bold text-xl mb-4 text-blue-900">ุชูุซูู ุจุตุฑู ูููุฌุงู ุงูููุฑุจุงุฆู</h3>
                    <!-- CSS Drawing of Transmission Lines Field -->
                    <div class="relative w-64 h-40 bg-gray-100 rounded-lg border border-gray-300 flex justify-center items-center overflow-hidden">
                        <!-- Ground -->
                        <div class="absolute bottom-0 w-full h-2 bg-green-600"></div>
                        <!-- Conductor A -->
                        <div class="absolute top-10 left-10 w-4 h-4 bg-red-600 rounded-full shadow-lg z-10"></div>
                        <div class="absolute top-9 left-9 w-6 h-6 border border-red-300 rounded-full opacity-50"></div>
                        <div class="absolute top-7 left-7 w-10 h-10 border border-red-200 rounded-full opacity-30"></div>
                        
                        <!-- Conductor B -->
                        <div class="absolute top-10 right-10 w-4 h-4 bg-blue-600 rounded-full shadow-lg z-10"></div>
                        <div class="absolute top-9 right-9 w-6 h-6 border border-blue-300 rounded-full opacity-50"></div>
                        <div class="absolute top-7 right-7 w-10 h-10 border border-blue-200 rounded-full opacity-30"></div>

                        <!-- Field Lines (CSS Arcs) -->
                        <div class="absolute top-12 left-14 right-14 h-10 border-t-2 border-dashed border-gray-400 rounded-[50%]"></div>
                        <div class="absolute top-14 left-14 right-14 h-10 border-t-2 border-dashed border-gray-400 rounded-[50%] opacity-60"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">ุฎุทูุท ุงููุฌุงู ุงูููุฑุจุงุฆู ุจูู ููุตููู</p>
                </div>
            </div>
        </section>

        <!-- SECTION 2: FACTORS -->
        <section id="sec-factors" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">ุงูุนูุงูู ุงูููุฏุณูุฉ ุงููุคุซุฑุฉ</h2>
                <p class="text-gray-700 mb-6">
                    ุชุนุชูุฏ ุณุนุฉ ุงูุฎุท ุจุดูู ุฃุณุงุณู ุนูู ุงูุชุจุงุนุฏ ุจูู ุงูููุตูุงุช ููุตู ูุทุฑ ุงูููุตู. ุงุณุชูุดู ุงูุนูุงูุฉ ุฃุฏูุงู:
                    <br>
                    <span class="font-mono bg-gray-100 px-2 py-1 rounded text-sm mt-2 inline-block" dir="ltr">Cn = 2ฯฮต / ln(D/r)</span>
                </p>

                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Controls -->
                    <div class="w-full lg:w-1/3 space-y-6 bg-gray-50 p-6 rounded-lg h-fit">
                        <div>
                            <label class="block font-bold text-gray-700 mb-2">ุงููุณุงูุฉ ุจูู ุงูููุตูุงุช (D)</label>
                            <input type="range" min="1" max="10" step="0.5" value="4" class="slidecontainer" id="slider-D">
                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                <span>1m</span>
                                <span id="val-D" class="font-bold text-blue-800">4m</span>
                                <span>10m</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">ูููุง ุฒุงุฏุช ุงููุณุงูุฉุ ููุช ุงูุณุนุฉ.</p>
                        </div>

                        <div>
                            <label class="block font-bold text-gray-700 mb-2">ูุตู ูุทุฑ ุงูููุตู (r)</label>
                            <input type="range" min="0.5" max="5" step="0.1" value="1.5" class="slidecontainer" id="slider-r">
                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                <span>0.5cm</span>
                                <span id="val-r" class="font-bold text-blue-800">1.5cm</span>
                                <span>5cm</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">ูููุง ุฒุงุฏ ูุตู ุงููุทุฑุ ุฒุงุฏุช ุงูุณุนุฉ (ุงูููุตูุงุช ุงูุญุฒููุฉ Bundled ุชุฒูุฏ ูู r ุงููุนุงู).</p>
                        </div>

                        <div class="p-4 bg-amber-50 border border-amber-200 rounded text-sm text-amber-900">
                            <strong>ููุงุญุธุฉ ููุฏุณูุฉ:</strong>
                            ุงุณุชุฎุฏุงู ุงูููุตูุงุช ุงูุญุฒููุฉ (Bundled Conductors) ูุฒูุฏ ูู ูุตู ุงููุทุฑ ุงูููุงูุฆ (GMR) ููุง ูุฒูุฏ ุงูุณุนุฉ ููููู ุงููุญุซุ ููู ุฃูุฑ ูุฑุบูุจ ูุฒูุงุฏุฉ ูุฏุฑุฉ ุงูููู.
                        </div>
                    </div>

                    <!-- Chart -->
                    <div class="w-full lg:w-2/3">
                        <div class="chart-container">
                            <canvas id="factorsChart"></canvas>
                        </div>
                        <p class="text-center text-sm text-gray-500 mt-2">ุงูุนูุงูุฉ ุจูู ุงููุณุงูุฉ (D) ูุงูุณุนุฉ (C) ุนูุฏ ูุตู ุงููุทุฑ ุงููุญุฏุฏ</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: FERRANTI EFFECT -->
        <section id="sec-ferranti" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">ุธุงูุฑุฉ ููุฑุงูุชู (Ferranti Effect)</h2>
                <p class="text-gray-700 mb-4">
                    ูู ุฎุทูุท ุงูููู ุงูุทูููุฉ ูุงููุชูุณุทุฉุ ุนูุฏ ุงูุชุดุบูู ุจุฏูู ุญูู (No Load) ุฃู ุจุญูู ุฎูููุ ูููู ุฌูุฏ ุงูุงุณุชูุจุงู (Vr) ุฃูุจุฑ ูู ุฌูุฏ ุงูุฅุฑุณุงู (Vs).
                    ุงูุณุจุจ ุงูุฑุฆูุณู ูู <strong>ุชูุงุฑ ุงูุดุญู ุงูุณุนูู</strong> ุงูุฐู ููุฑ ูู ููุงูุนุฉ ุงูุฎุท.
                </p>

                <div class="flex flex-wrap gap-4 mb-6">
                    <button onclick="updateFerranti(true)" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow transition">ุชุดุบูู ุจุญูู ูุงูู (Full Load)</button>
                    <button onclick="updateFerranti(false)" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded shadow transition">ุชุดุบูู ุจุฏูู ุญูู (No Load)</button>
                </div>

                <div class="w-full">
                    <div class="chart-container" style="max-height: 450px;">
                        <div id="ferrantiPlot" style="width:100%; height:100%;"></div>
                    </div>
                    <div class="mt-4 text-center">
                        <p id="ferranti-desc" class="font-bold text-red-600 text-lg">ุงูุญุงูุฉ: ุจุฏูู ุญูู - ูุงุญุธ ุงุฑุชูุงุน ุงูุฌูุฏ ูู ููุงูุฉ ุงูุฎุท!</p>
                    </div>
                </div>

                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 p-4 rounded border border-gray-200">
                        <h4 class="font-bold text-blue-900 mb-2">ุงููุฎุงุทุฑ</h4>
                        <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                            <li>ุฅุฌูุงุฏ ุงูุนูุงุฒู ุงูููุฑุจุงุฆูุฉ.</li>
                            <li>ุชูู ุงููุนุฏุงุช ุงูุญุณุงุณุฉ ููุฌูุฏ ุงูุฒุงุฆุฏ.</li>
                            <li>ุนุฏู ุงุณุชูุฑุงุฑ ุงููููุฏุงุช.</li>
                        </ul>
                    </div>
                    <div class="bg-gray-50 p-4 rounded border border-gray-200">
                        <h4 class="font-bold text-blue-900 mb-2">ุงูุญููู (Compensation)</h4>
                        <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                            <li>ุชุฑููุจ ููุงุนูุงุช ุชูุงุฒู (Shunt Reactors).</li>
                            <li>ุงุณุชุฎุฏุงู ูุนูุถุงุช ุงูุงุณุชุงุชูููุฉ (SVC).</li>
                            <li>ุชุดุบูู ุงูุฎุท ุจุฌูุฏ ุฃูู ุนูุฏ ุงููุงุญูู.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: MODELING -->
        <section id="sec-models" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">ููุฐุฌุฉ ุงูุฎุทูุท ูุชูุซูู ุงูุณุนุฉ</h2>
                <p class="text-gray-700 mb-6">
                    ุชุฎุชูู ุทุฑููุฉ ุชูุซูู ุงูุณุนุฉ ุญุณุจ ุทูู ุงูุฎุท. ููุฎุทูุท ุงููุชูุณุทุฉ (80-250 ูู)ุ ูุณุชุฎุฏู ููุงุฐุฌ ุงูุชุฌููุน (Lumped Parameters).
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Pi Model -->
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-blue-500 transition-colors">
                        <h3 class="text-center font-bold text-lg mb-4 text-blue-800">ูููุฐุฌ ุจุงู (Nominal ฯ Model)</h3>
                        <p class="text-sm text-gray-600 text-center mb-6">ูุชู ุชูุณูู ุงูุณุนุฉ ุงููููุฉ (C) ุฅูู ูุตูููุ ููุถุน ูู ูุตู ุนูุฏ ุทุฑูู ุงูุฎุท.</p>
                        
                        <!-- CSS Schematic Pi -->
                        <div class="h-40 relative flex justify-center items-center font-mono text-sm">
                            <!-- Horizontal Line (Series Z) -->
                            <div class="absolute top-10 left-10 right-10 h-1 bg-gray-800"></div>
                            <div class="absolute top-8 left-[40%] bg-white px-2 border border-gray-800 rounded">R + jX</div>

                            <!-- Left Capacitor (C/2) -->
                            <div class="absolute top-10 left-16 w-1 h-20 bg-gray-800"></div>
                            <div class="absolute top-30 left-[3.5rem] w-8 h-1 bg-gray-800"></div> <!-- Plate 1 -->
                            <div class="absolute top-32 left-[3.5rem] w-8 h-1 bg-gray-800"></div> <!-- Plate 2 -->
                            <div class="absolute top-32 left-16 w-1 h-8 bg-gray-800"></div>
                            <div class="absolute top-[6.5rem] left-8 text-blue-600 font-bold">C/2</div>

                            <!-- Right Capacitor (C/2) -->
                            <div class="absolute top-10 right-16 w-1 h-20 bg-gray-800"></div>
                            <div class="absolute top-30 right-[3.5rem] w-8 h-1 bg-gray-800"></div> <!-- Plate 1 -->
                            <div class="absolute top-32 right-[3.5rem] w-8 h-1 bg-gray-800"></div> <!-- Plate 2 -->
                            <div class="absolute top-32 right-16 w-1 h-8 bg-gray-800"></div>
                            <div class="absolute top-[6.5rem] right-8 text-blue-600 font-bold">C/2</div>

                            <!-- Ground Line -->
                            <div class="absolute bottom-0 left-5 right-5 h-0.5 bg-gray-400"></div>
                        </div>
                        <p class="text-center text-xs text-gray-400 mt-2">ุงูุฃูุซุฑ ุดููุนุงู ูุงุณุชุฎุฏุงูุงู ูู ุชุญููู ุฃูุธูุฉ ุงูููู</p>
                    </div>

                    <!-- T Model -->
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-amber-500 transition-colors">
                        <h3 class="text-center font-bold text-lg mb-4 text-amber-800">ูููุฐุฌ ุชู (Nominal T Model)</h3>
                        <p class="text-sm text-gray-600 text-center mb-6">ูุชู ุชุฑููุฒ ุงูุณุนุฉ ุงููููุฉ (C) ูู ููุชุตู ุงูุฎุทุ ูุชูุณู ุงูููุงูุนุฉ.</p>
                        
                        <!-- CSS Schematic T -->
                        <div class="h-40 relative flex justify-center items-center font-mono text-sm">
                            <!-- Horizontal Lines (Z/2) -->
                            <div class="absolute top-10 left-10 w-[40%] h-1 bg-gray-800"></div>
                            <div class="absolute top-10 right-10 w-[40%] h-1 bg-gray-800"></div>
                            <div class="absolute top-8 left-16 bg-white px-1 border border-gray-800 rounded text-xs">Z/2</div>
                            <div class="absolute top-8 right-16 bg-white px-1 border border-gray-800 rounded text-xs">Z/2</div>

                            <!-- Middle Capacitor (C) -->
                            <div class="absolute top-10 left-[50%] w-1 h-20 bg-gray-800 translate-x-[-50%]"></div>
                            <div class="absolute top-30 left-[50%] w-8 h-1 bg-gray-800 translate-x-[-50%]"></div>
                            <div class="absolute top-32 left-[50%] w-8 h-1 bg-gray-800 translate-x-[-50%]"></div>
                            <div class="absolute top-32 left-[50%] w-1 h-8 bg-gray-800 translate-x-[-50%]"></div>
                            <div class="absolute top-[6.5rem] left-[55%] text-amber-600 font-bold">C</div>

                            <!-- Ground Line -->
                            <div class="absolute bottom-0 left-5 right-5 h-0.5 bg-gray-400"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 5: CALCULATOR -->
        <section id="sec-calculator" class="hidden space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-blue-900 mb-4 border-r-4 border-amber-600 pr-3">ุญุงุณุจุฉ ุชูุงุฑ ุงูุดุญู (Charging Current)</h2>
                <p class="text-gray-700 mb-6">
                    ุงุณุชุฎุฏู ูุฐู ุงูุฃุฏุงุฉ ูุชูุฏูุฑ ุชูุงุฑ ุงูุดุญู ูุงููุฏุฑุฉ ุบูุฑ ุงููุนุงูุฉ (MVAR) ุงูุชู ูููุฏูุง ุงูุฎุท.
                    <br>
                    <span class="text-sm text-gray-500">ููุงุญุธุฉ: ูุฐู ุญุณุงุจุงุช ุชูุฑูุจูุฉ ูุฎุท ุซูุงุซู ุงูุฃูุฌู (3-Phase).</span>
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Inputs -->
                    <div class="space-y-4 bg-gray-50 p-6 rounded-lg">
                        <h3 class="font-bold text-lg mb-4 text-gray-800">ุจูุงูุงุช ุงูุฎุท</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ุฌูุฏ ุงูุฎุท (Line Voltage - kV)</label>
                            <input type="number" id="calc-v" value="220" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">ุงูุชุฑุฏุฏ (Frequency - Hz)</label>
                            <input type="number" id="calc-f" value="50" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">ุทูู ุงูุฎุท (km)</label>
                            <input type="number" id="calc-l" value="150" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">ุงูุณุนุฉ (ฮผF/km)</label>
                            <input type="number" id="calc-c" value="0.012" step="0.001" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <button onclick="calculate()" class="w-full bg-blue-900 text-white py-2 rounded-md hover:bg-blue-800 transition">ุงุญุณุจ ุงููุชุงุฆุฌ</button>
                    </div>

                    <!-- Results -->
                    <div class="space-y-6 flex flex-col justify-center">
                        <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600">
                            <h4 class="text-sm text-gray-500 uppercase font-bold">ุชูุงุฑ ุงูุดุญู ุงูููู (Ic)</h4>
                            <div class="flex items-end gap-2">
                                <span id="res-ic" class="text-4xl font-bold text-blue-900">--</span>
                                <span class="text-xl text-gray-600 mb-1">Amps</span>
                            </div>
                        </div>

                        <div class="bg-amber-50 p-6 rounded-lg border-l-4 border-amber-600">
                            <h4 class="text-sm text-gray-500 uppercase font-bold">ุงููุฏุฑุฉ ุบูุฑ ุงููุนุงูุฉ ุงููููุฏุฉ (Qc)</h4>
                            <div class="flex items-end gap-2">
                                <span id="res-mvar" class="text-4xl font-bold text-amber-900">--</span>
                                <span class="text-xl text-gray-600 mb-1">MVAR</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">3-Phase Total Reactive Power</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <h3 class="font-bold text-lg mb-2">ุชูุฑูุฑ ููุฏุณู: ุณุนุฉ ุฎุทูุท ุงูููู</h3>
            <p class="text-gray-400 text-sm max-w-2xl mx-auto">
                ุชู ุฅุนุฏุงุฏ ูุฐุง ุงูุชูุฑูุฑ ุงูุชูุงุนูู ูุชูุถูุญ ุงูููุงููู ุงูุฃุณุงุณูุฉุ ุงูุนูุงูู ุงููุคุซุฑุฉุ ูุชุฃุซูุฑุงุช ุงูุชุดุบูู ุงููุชุนููุฉ ุจุงูุณุนุฉ ูู ุดุจูุงุช ุงูููู ุงูููุฑุจูุฉ.
            </p>
            <div class="mt-4 text-xs text-gray-500">
                &copy; 2023 Engineering Reports SPA
            </div>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- State Management ---
        const state = {
            currentSection: 'overview',
            factors: {
                d: 4, // Spacing in meters
                r: 1.5 // Radius in cm
            },
            ferrantiLoaded: false
        };

        // --- Navigation Logic ---
        function switchTab(tabId) {
            state.currentSection = tabId;

            // UI: Update Buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById(`btn-${tabId}`);
            if (activeBtn) activeBtn.classList.add('active');

            // UI: Show/Hide Sections (defensive checks)
            ['overview', 'factors', 'ferranti', 'models', 'calculator'].forEach(sec => {
                const el = document.getElementById(`sec-${sec}`);
                if (!el) return;
                if (sec === tabId) el.classList.remove('hidden'); else el.classList.add('hidden');
            });

            // Trigger visual updates if needed
            if (tabId === 'factors') updateFactorsChart();
            if (tabId === 'ferranti') updateFerrantiPlot();
        }

        // --- Factors Chart Logic (Chart.js) ---
        let factorsChart = null;

        function initFactorsChart() {
            const canvas = document.getElementById('factorsChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            const dataPoints = generateFactorsData(state.factors.r);

            factorsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dataPoints.labels,
                    datasets: [{
                        label: `Capacitance (ฮผF/km) @ r=${state.factors.r}cm`,
                        data: dataPoints.data,
                        borderColor: '#1E3A8A',
                        backgroundColor: 'rgba(30, 58, 138, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        pointRadius: 0,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'ุงููุณุงูุฉ ุจูู ุงูููุตูุงุช (m)' }, grid: { color: '#e5e7eb' } },
                        y: { title: { display: true, text: 'ุงูุณุนุฉ C (ฮผF/km)' }, grid: { color: '#e5e7eb' } }
                    },
                    plugins: {
                        tooltip: {
                            intersect: false,
                            mode: 'index',
                            callbacks: {
                                label: function(context) {
                                    const y = context.parsed && context.parsed.y;
                                    return y == null ? 'C: -' : `C: ${y.toFixed(4)} ฮผF/km`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function generateFactorsData(radiusCm) {
            const labels = [];
            const data = [];
            const r_m = radiusCm / 100; // convert radius to meters

            for (let d = 1; d <= 10; d += 0.5) {
                labels.push(d);
                if (d > r_m && r_m > 0) {
                    // use log10 as approximation but protect against invalid values
                    const ratio = d / r_m;
                    const c = 0.0241 / Math.log10(ratio);
                    data.push(isFinite(c) ? c : null);
                } else {
                    data.push(null);
                }
            }
            return { labels, data };
        }

        function updateFactorsChart() {
            if (!factorsChart) {
                initFactorsChart();
                return;
            }
            const newData = generateFactorsData(state.factors.r);
            factorsChart.data.datasets[0].label = `Capacitance (ฮผF/km) @ r=${state.factors.r}cm`;
            factorsChart.data.datasets[0].data = newData.data;
            factorsChart.update();
        }

        function setupFactorsControls() {
            const sliderD = document.getElementById('slider-D');
            const sliderR = document.getElementById('slider-r');
            const valD = document.getElementById('val-D');
            const valR = document.getElementById('val-r');

            if (valD) valD.textContent = state.factors.d + 'm';
            if (valR) valR.textContent = state.factors.r + 'cm';

            if (sliderD && valD) {
                sliderD.addEventListener('input', (e) => {
                    state.factors.d = parseFloat(e.target.value);
                    valD.textContent = state.factors.d + 'm';
                });
            }

            if (sliderR && valR) {
                sliderR.addEventListener('input', (e) => {
                    state.factors.r = parseFloat(e.target.value);
                    valR.textContent = state.factors.r + 'cm';
                    updateFactorsChart();
                });
            }
        }

        // --- Ferranti Plot Logic (Plotly.js) ---
        function updateFerranti(isLoaded) {
            state.ferrantiLoaded = isLoaded;
            const desc = document.getElementById('ferranti-desc');
            if (desc) {
                if (isLoaded) {
                    desc.textContent = 'ุงูุญุงูุฉ: ุญูู ูุงูู - ุงูุฎูุงุถ ุงูุฌูุฏ ุทุจูุนู ุจุณุจุจ ุงูููุงูุนุฉ.';
                    desc.className = 'font-bold text-green-600 text-lg';
                } else {
                    desc.textContent = 'ุงูุญุงูุฉ: ุจุฏูู ุญูู - ูุงุญุธ ุงุฑุชูุงุน ุงูุฌูุฏ (Ferranti Effect)!';
                    desc.className = 'font-bold text-red-600 text-lg';
                }
            }
            updateFerrantiPlot();
        }

        function updateFerrantiPlot() {
            const plotEl = document.getElementById('ferrantiPlot');
            if (!plotEl) return;

            const distance = Array.from({length: 301}, (_, i) => i);
            const voltage = distance.map(x => {
                if (!state.ferrantiLoaded) return 1.0 + (0.0000005 * x * x);
                return 1.0 - (0.00015 * x);
            });

            const trace = {
                x: distance, y: voltage, mode: 'lines',
                line: { color: state.ferrantiLoaded ? '#16a34a' : '#dc2626', width: 3 },
                fill: 'tozeroy', fillcolor: state.ferrantiLoaded ? 'rgba(22,163,74,0.1)' : 'rgba(220,38,38,0.1)'
            };

            const layout = {
                title: { text: state.ferrantiLoaded ? 'ุชูุฒูุน ุงูุฌูุฏ (Full Load)' : 'ุชูุฒูุน ุงูุฌูุฏ (No Load - Ferranti)', font: { family: 'Tajawal' } },
                xaxis: { title: 'ุทูู ุงูุฎุท (ูู)' }, yaxis: { title: 'ุงูุฌูุฏ (p.u.)', range: [0.9, 1.1] },
                margin: { t: 40, r: 20, l: 50, b: 40 }, font: { family: 'Tajawal' }
            };

            Plotly.newPlot('ferrantiPlot', [trace], layout, { responsive: true, displayModeBar: false });
        }

        // --- Calculator Logic ---
        function calculate() {
            const vEl = document.getElementById('calc-v');
            const fEl = document.getElementById('calc-f');
            const lEl = document.getElementById('calc-l');
            const cEl = document.getElementById('calc-c');
            if (!vEl || !fEl || !lEl || !cEl) return;

            const V_kV = parseFloat(vEl.value);
            const f = parseFloat(fEl.value);
            const L = parseFloat(lEl.value);
            const C_uF = parseFloat(cEl.value);
            if (isNaN(V_kV) || isNaN(f) || isNaN(L) || isNaN(C_uF)) return;

            const V_phase = (V_kV * 1000) / Math.sqrt(3);
            const C_total = C_uF * 1e-6 * L;
            const omega = 2 * Math.PI * f;
            const Ic = omega * C_total * V_phase;
            const Qc_VAR = Math.sqrt(3) * (V_kV * 1000) * Ic;
            const Qc_MVAR = Qc_VAR / 1e6;

            animateValue('res-ic', 0, Ic, 1000, 1);
            animateValue('res-mvar', 0, Qc_MVAR, 1000, 2);
        }

        function animateValue(id, start, end, duration, decimals) {
            const obj = document.getElementById(id);
            if (!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = (progress * (end - start) + start).toFixed(decimals);
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        // Initialize on Load (attach listeners and init charts safely)
        window.addEventListener('DOMContentLoaded', () => {
            setupFactorsControls();
            initFactorsChart();
            // Ensure initial section visibility
            switchTab(state.currentSection);
            // Initialize ferranti plot state
            updateFerrantiPlot();
            // Run initial calculation (if inputs exist)
            calculate();
        });

    </script>
</body>
</html>